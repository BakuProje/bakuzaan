<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vonix PS - Admin Panel</title>
    <link rel="shortcut icon" href="https://files.catbox.moe/qc4knm.jpg" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #4361ee;
            --primary-dark: #3a56d4;
            --secondary-color: #4cc9f0;
            --success-color: #4ade80;
            --danger-color: #f43f5e;
            --warning-color: #fbbf24;
            --dark-color: #1e293b;
            --light-color: #f8fafc;
            --gray-color: #94a3b8;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f1f5f9;
            color: var(--dark-color);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }


        .login-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, #4361ee, #3a0ca3);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
            width: 100%;
        }
        
        .sidebar {
            width: 280px;
            background: linear-gradient(145deg, #4361ee, #3a0ca3);
            color: white;
            padding: 20px;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            z-index: 10;
            transition: var(--transition);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            margin-bottom: 20px;
        }
        
        .logo img {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: var(--transition);
        }
        
        .logo img:hover {
            transform: scale(1.1);
            border-color: white;
        }
        
        .logo h2 {
            font-size: 18px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .server-status-panel {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .server-status-panel h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .server-status-panel h3 i {
            color: #4cc9f0;
        }
        
        .status-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .status-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            background-color: rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }
        
        .status-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }
        
        .status-btn.active {
            background-color: rgba(255, 255, 255, 0.15);
            border-left: 3px solid #4cc9f0;
        }
        
        .status-color {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .status-color.online {
            background-color: #4ade80;
            box-shadow: 0 0 5px #4ade80;
        }
        
        .status-color.offline {
            background-color: #f43f5e;
            box-shadow: 0 0 5px #f43f5e;
        }
        
        .status-color.maintenance {
            background-color: #fbbf24;
            box-shadow: 0 0 5px #fbbf24;
        }
        
        .custom-status {
            margin-top: 10px;
        }
        
        .custom-status input {
            width: 100%;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            background-color: rgba(255, 255, 255, 0.05);
            color: white;
            margin-bottom: 10px;
        }
        
        .custom-status input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .custom-status input:focus {
            outline: none;
            border-color: #4cc9f0;
        }
        
        .apply-custom-btn {
            width: 100%;
            padding: 8px 12px;
            border-radius: 8px;
            background-color: #4cc9f0;
            border: none;
            color: #0f172a;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .apply-custom-btn:hover {
            background-color: #4361ee;
            color: white;
            transform: translateY(-2px);
        }
        
        .user-list {
            list-style: none;
            margin-top: 20px;
        }
        
        .user-item {
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background-color: rgba(255, 255, 255, 0.08);
            border-left: 4px solid transparent;
            display: flex;
            flex-direction: column;
        }
        
        .user-item:hover {
            background-color: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
            border-left-color: #4cc9f0;
        }
        
        .user-item.active {
            background-color: rgba(255, 255, 255, 0.2);
            border-left-color: white;
        }
        
        .user-item .name {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .user-item .preview {
            font-size: 12px;
            opacity: 0.8;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
            margin-bottom: 5px;
        }
        
        .user-item .time {
            font-size: 11px;
            opacity: 0.7;
            display: flex;
            align-items: center;
        }
        
        .user-item .time i {
            margin-right: 5px;
            font-size: 10px;
        }
        
        .user-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
            display: inline-block;
        }
        
        .status-online {
            background-color: #4ade80;
            box-shadow: 0 0 0 2px rgba(74, 222, 128, 0.3);
        }
        
        .status-away {
            background-color: #fbbf24;
            box-shadow: 0 0 0 2px rgba(251, 191, 36, 0.3);
        }
        
        .status-offline {
            background-color: #94a3b8;
            box-shadow: 0 0 0 2px rgba(148, 163, 184, 0.3);
        }
        
        .user-item .notification {
            background-color: #f43f5e;
            color: white;
            min-width: 20px;
            height: 20px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 11px;
            font-weight: 600;
            padding: 0 6px;
            box-shadow: 0 0 0 3px rgba(244, 63, 94, 0.2);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(244, 63, 94, 0.5);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(244, 63, 94, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(244, 63, 94, 0);
            }
        }
        
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: white;
            box-shadow: var(--shadow-sm);
            border-radius: 0 16px 16px 0;
            overflow: hidden;
        }
        
        .chat-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background-color: #1a1a2e;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(145deg, var(--primary-color), var(--secondary-color));
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 500;
            font-size: 18px;
            box-shadow: var(--shadow-md);
        }
        
        .user-details h3 {
            font-size: 17px;
            font-weight: 600;
            color: white;
            margin-bottom: 2px;
        }
        
        .user-details p {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            margin: 0;
        }
        
        .actions {
            display: flex;
            gap: 12px;
        }
        
        .actions button {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        #backBtn {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        #backBtn:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        #endChatBtn {
            background-color: rgba(244, 63, 94, 0.2);
            color: #fecaca;
            border: 1px solid rgba(244, 63, 94, 0.3);
        }
        
        #endChatBtn:hover {
            background-color: rgba(244, 63, 94, 0.3);
            transform: translateY(-2px);
        }

        .actions button:last-child {
            background-color: #ef4444 !important;
            color: white !important;
            border: none;
        }

        .actions button:last-child:hover {
            background-color: #dc2626 !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(220, 38, 38, 0.5);
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: #f8fafc;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(67, 97, 238, 0.03) 1%, transparent 2%),
                radial-gradient(circle at 75% 75%, rgba(67, 97, 238, 0.03) 1%, transparent 2%);
            background-size: 50px 50px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .message-date-separator {
            text-align: center;
            margin: 15px 0;
            position: relative;
        }
        
        .message-date-separator::before {
            content: "";
            position: absolute;
            left: 0;
            top: 50%;
            width: 100%;
            height: 1px;
            background-color: #e2e8f0;
            z-index: 1;
        }
        
        .message-date-separator span {
            background-color: #f8fafc;
            padding: 0 15px;
            position: relative;
            z-index: 2;
            font-size: 12px;
            color: #94a3b8;
            font-weight: 500;
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .message {
            max-width: 75%;
            padding: 14px 16px;
            border-radius: 18px;
            position: relative;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        .message:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        .user-message {
            align-self: flex-start;
            background-color: white;
            border-bottom-left-radius: 4px;
        }
        
        .owner-message {
            align-self: flex-end;
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
            border-bottom-right-radius: 4px;
        }
        
        .message .sender {
            font-weight: 600;
            margin-bottom: 6px;
            font-size: 13px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .user-message .sender {
            color: #4361ee;
        }
        
        .owner-message .sender {
            color: rgba(255, 255, 255, 0.9);
        }
        
        .message .time {
            position: absolute;
            bottom: 5px;
            right: 8px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .owner-message .time {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .message .content {
            margin-bottom: 20px;
            line-height: 1.6;
            font-size: 14px;
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            margin-left: 10px;
            margin-top: 5px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #94a3b8;
            margin-right: 5px;
            animation: typingAnimation 1.5s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.3s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.6s;
        }
        
        @keyframes typingAnimation {
            0%, 100% { transform: translateY(0); opacity: 0.5; }
            50% { transform: translateY(-5px); opacity: 1; }
        }
        
        .chat-input {
            padding: 18px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            background-color: white;
        }
        
        .upload-image-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 22px;
            cursor: pointer;
            padding: 0 10px;
            transition: var(--transition);
            height: 45px;
            width: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .upload-image-btn:hover {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-dark);
            transform: scale(1.1);
        }
        
        .chat-input input {
            flex: 1;
            padding: 12px 18px;
            border: 1px solid var(--border-color);
            border-radius: 25px;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            transition: var(--transition);
        }
        
        .chat-input input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
        }
        
        .chat-input button {
            padding: 0 25px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(145deg, var(--primary-color), var(--primary-dark));
            color: white;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            height: 45px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .chat-input button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
        }
        
        .no-chat-selected {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f8fafc;
            flex-direction: column;
            gap: 25px;
            color: var(--gray-color);
            border-radius: 0 16px 16px 0;
        }
        
        .no-chat-selected i {
            font-size: 60px;
            color: var(--gray-color);
            background: linear-gradient(145deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .no-chat-selected h3 {
            font-size: 22px;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .no-chat-selected p {
            font-size: 15px;
            max-width: 450px;
            text-align: center;
            line-height: 1.6;
        }
        
        .empty-state {
            display: flex;
            flex: 1;
            justify-content: center;
            align-items: center;
            color: var(--gray-color);
            font-size: 15px;
            padding: 20px;
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.1);
            margin-top: 10px;
        }
        
        @media (max-width: 768px) {
            .admin-container {
                flex-direction: column;
                height: 100vh;
                overflow: hidden;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                max-height: 45vh;
                border-radius: 0;
                padding: 15px;
                overflow-y: auto;
            }

            .logo {
                padding-bottom: 15px;
                margin-bottom: 15px;
            }

            .logo img {
                width: 35px;
                height: 35px;
            }

            .logo h2 {
                font-size: 16px;
            }

            .server-status-panel {
                margin: 10px 0;
                padding: 12px;
            }

            .server-status-panel h3 {
                font-size: 14px;
                margin-bottom: 10px;
            }

            .status-btn {
                padding: 8px 10px;
                font-size: 13px;
            }

            .user-list {
                margin-top: 10px;
            }

            .user-item {
                padding: 12px;
                margin-bottom: 8px;
            }

            .user-item .name {
                font-size: 14px;
            }

            .user-item .preview {
                font-size: 12px;
                max-width: 100%;
            }

            .chat-container {
                height: 55vh;
                border-radius: 20px 20px 0 0;
                margin-top: -20px;
                background: white;
                position: relative;
                z-index: 10;
            }

            .chat-header {
                padding: 15px;
                border-radius: 20px 20px 0 0;
            }

            .user-avatar {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }

            .user-details h3 {
                font-size: 15px;
            }

            .user-details p {
                font-size: 12px;
            }

            .actions {
                gap: 8px;
            }

            .actions button {
                padding: 8px 12px;
                font-size: 12px;
            }

            .chat-messages {
                padding: 15px;
                height: calc(55vh - 130px);
            }

            .message {
                max-width: 85%;
                padding: 12px;
                font-size: 13px;
            }

            .chat-input {
                padding: 12px;
                gap: 8px;
            }

            .chat-input input {
                padding: 10px 15px;
                font-size: 13px;
            }

            .upload-image-btn {
                width: 35px;
                height: 35px;
                font-size: 18px;
            }

            .no-chat-selected {
                padding: 20px;
                text-align: center;
            }

            .no-chat-selected i {
                font-size: 40px;
                margin-bottom: 15px;
            }

            .no-chat-selected h3 {
                font-size: 18px;
                margin-bottom: 10px;
            }

            .no-chat-selected p {
                font-size: 13px;
            }

            .connection-status {
                bottom: 10px;
                left: 10px;
                font-size: 11px;
                padding: 6px 12px;
            }
        }

        @media (min-width: 769px) {
            .admin-container {
                height: 100vh;
                overflow: hidden;
            }

            .sidebar {
                width: 300px;
                border-radius: 20px 0 0 20px;
                padding: 25px;
            }

            .chat-container {
                flex: 1;
                border-radius: 0 20px 20px 0;
                display: flex;
                flex-direction: column;
            }

            .chat-messages {
                flex: 1;
                height: calc(100vh - 180px);
            }

            .message {
                max-width: 70%;
            }

            .no-chat-selected {
                border-radius: 0 20px 20px 0;
            }
        }

 
        .chat-container, .no-chat-selected {
            background-color: #f8fafc;
        }

        .message.user-message {
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .message.owner-message {
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
            box-shadow: 0 2px 5px rgba(67, 97, 238, 0.15);
        }

      
        * {
            scroll-behavior: smooth;
        }

      
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.4);
        }

     
        @media (hover: none) {
            .user-item, .status-btn, .actions button {
                -webkit-tap-highlight-color: transparent;
            }

            .user-item:active, .status-btn:active, .actions button:active {
                transform: scale(0.98);
            }
        }
      
        .connection-status {
            position: fixed;
            bottom: 15px;
            left: 15px;
            background-color: rgba(15, 23, 42, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 100;
            box-shadow: var(--shadow-md);
            backdrop-filter: blur(5px);
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--warning-color);
            box-shadow: 0 0 10px var(--warning-color);
            transition: var(--transition);
        }

        .status-sending, .status-sent, .status-failed {
            font-size: 12px;
            text-align: right;
            margin-top: 5px;
            margin-right: 10px;
            font-weight: 500;
        }

        .status-sending {
            color: var(--gray-color);
            font-style: italic;
        }

        .status-sent {
            color: var(--success-color);
        }

        .status-failed {
            color: var(--danger-color);
        }
        
        .message-image {
            max-width: 300px;
            max-height: 200px;
            border-radius: 10px;
            margin: 5px 0;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .message-image:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-md);
        }
        
        .image-preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .image-preview-modal.active {
            display: flex;
            opacity: 1;
        }

        .preview-image {
            max-width: 90%;
            max-height: 90%;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .image-preview-modal.active .preview-image {
            transform: scale(1);
        }

        .close-preview {
            position: absolute;
            top: 25px;
            right: 25px;
            color: white;
            font-size: 35px;
            cursor: pointer;
            transition: var(--transition);
            width: 50px;
            height: 50px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-preview:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }
       
        .upload-progress {
            height: 6px;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            margin: 8px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            width: 0;
            transition: width 0.3s ease;
            border-radius: 3px;
        }
        
        .image-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 300px;
            height: 150px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin: 5px 0;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            padding: 20px;
        }

        .image-loading i {
            margin-bottom: 10px;
            font-size: 24px;
            animation: spin 1.5s infinite ease;
            color: var(--secondary-color);
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .message {
            animation: messageAppear 0.3s ease-out;
        }
        
        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        

        .message-system {
            width: 90%;
            margin: 10px auto;
            padding: 10px 15px;
            background-color: rgba(255, 193, 7, 0.1);
            border: 1px dashed #ffc107;
            border-radius: 8px;
            text-align: center;
            color: #664d03;
            font-size: 13px;
            animation: fadeIn 0.5s ease-out;
        }
        
        .message-system .system-content {
            margin-bottom: 5px;
        }
        
        .message-system .system-time {
            font-size: 11px;
            opacity: 0.7;
        }
        
 
        .user-item.archived {
            background-color: rgba(255, 255, 255, 0.05);
            border-left-color: #ffc107;
        }
        
        .user-item.archived::after {
            content: "DIARSIPKAN";
            position: absolute;
            top: 5px;
            right: 8px;
            font-size: 9px;
            background-color: #ffc107;
            color: #000;
            padding: 2px 5px;
            border-radius: 4px;
            opacity: 0.8;
        }

   
        .message .time {
            position: absolute;
            bottom: 5px;
            right: 8px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .message {
            position: relative;
            padding-bottom: 25px; 
        }

        .message-date-separator {
            display: none;
        }

        .login-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, #4361ee, #3a0ca3);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .login-box {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 400px;
        }

        .login-box h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #1e293b;
        }

        .login-form input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
        }

        .login-form button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(145deg, #4361ee, #3a0ca3);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            transition: transform 0.3s ease;
        }

        .login-form button:hover {
            transform: translateY(-2px);
        }

        .error-message {
            color: #dc2626;
            text-align: center;
            margin-bottom: 15px;
            display: none;
        }

        .server-status-manager {
            margin-left: 15px;
        }
        
        .server-status-btn {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .server-status-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .server-status-btn .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .server-status-btn.online .status-dot {
            background-color: #4ade80;
            box-shadow: 0 0 8px #4ade80;
        }
        
        .server-status-btn.maintenance .status-dot {
            background-color: #fbbf24;
            box-shadow: 0 0 8px #fbbf24;
        }
        
        .server-status-btn.offline .status-dot {
            background-color: #f43f5e;
            box-shadow: 0 0 8px #f43f5e;
        }
        
        .server-status-btn .status-text {
            color: white;
            font-size: 13px;
            font-weight: 500;
        }
        
     
        .status-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        
        .status-modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 25px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transform: translateY(-20px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .status-modal.show .status-modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        
        .status-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .status-modal-header h3 {
            font-size: 20px;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
        }
        
        .close-status-modal {
            font-size: 24px;
            cursor: pointer;
            color: #94a3b8;
            transition: all 0.2s ease;
        }
        
        .close-status-modal:hover {
            color: #1e293b;
        }
        
        .status-option {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .status-option:hover {
            background-color: #f8fafc;
        }
        
        .status-option.selected {
            background-color: #f1f5f9;
            border-left: 3px solid #4361ee;
        }
        
        .status-option .status-dot {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 15px;
        }
        
        .status-option .status-dot.online {
            background-color: #4ade80;
            box-shadow: 0 0 10px rgba(74, 222, 128, 0.5);
        }
        
        .status-option .status-dot.maintenance {
            background-color: #fbbf24;
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }
        
        .status-option .status-dot.offline {
            background-color: #f43f5e;
            box-shadow: 0 0 10px rgba(244, 63, 94, 0.5);
        }
        
        .status-details h4 {
            margin: 0 0 5px 0;
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
        }
        
        .status-details p {
            margin: 0;
            font-size: 13px;
            color: #64748b;
        }
        
        .status-message {
            margin-top: 20px;
        }
        
        .status-message label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #334155;
        }
        
        .status-message input {
            width: 100%;
            padding: 12px 15px;
            font-size: 14px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        .status-message input:focus {
            outline: none;
            border-color: #4361ee;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
        }
        
        .status-modal-footer {
            display: flex;
            justify-content: flex-end;
            margin-top: 25px;
            gap: 15px;
        }
        
        .status-modal-footer button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        #cancelStatusChange {
            background-color: #e2e8f0;
            color: #475569;
        }
        
        #cancelStatusChange:hover {
            background-color: #cbd5e1;
        }
        
        #saveStatusChange {
            background-color: #4361ee;
            color: white;
        }
        
        #saveStatusChange:hover {
            background-color: #3a56d4;
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.3);
        }
        
        @media (max-width: 640px) {
            .status-modal-content {
                width: 95%;
                margin: 20% auto;
            }
        }

        
        .server-status-control {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 20px;
            margin: 20px 0;
            width: 100%;
        }

        .server-status-control h3 {
            margin-bottom: 15px;
            font-size: 18px;
            color: #1e293b;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .status-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .status-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            background-color: #f8fafc;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            color: #334155;
        }

        .status-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .status-btn.active {
            background-color: #f1f5f9;
            border-color: #94a3b8;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .status-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-color.online {
            background-color: #4ade80;
            box-shadow: 0 0 5px #4ade80;
        }

        .status-color.offline {
            background-color: #f43f5e;
            box-shadow: 0 0 5px #f43f5e;
        }

        .status-color.maintenance {
            background-color: #fbbf24;
            box-shadow: 0 0 5px #fbbf24;
        }

        .custom-status {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .custom-status input {
            flex: 1;
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
        }

        .custom-status input:focus {
            outline: none;
            border-color: #4361ee;
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.2);
        }

        .apply-custom-btn {
            padding: 10px 15px;
            background: linear-gradient(145deg, #4361ee, #3a0ca3);
            color: white;
            border: none;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .apply-custom-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(58, 12, 163, 0.3);
        }

        .status-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .status-modal.show {
            opacity: 1;
        }

        .status-modal-content {
            position: relative;
            background: #1a1a2e;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            margin: 50px auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            transform: translateY(-20px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .status-modal.show .status-modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        .status-modal-header {
            display: flex;
            align-items: center;
            padding: 25px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            gap: 20px;
        }

        .header-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-icon i {
            font-size: 24px;
            color: white;
        }

        .header-text h3 {
            color: white;
            margin: 0;
            font-size: 20px;
            font-weight: 600;
        }

        .header-text p {
            color: rgba(255, 255, 255, 0.7);
            margin: 5px 0 0;
            font-size: 14px;
        }

        .close-status-modal {
            position: absolute;
            right: 20px;
            top: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-status-modal i {
            color: white;
            font-size: 18px;
        }

        .close-status-modal:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .status-modal-body {
            padding: 30px;
        }

        .status-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .status-option {
            display: flex;
            align-items: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .status-option:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(5px);
        }

        .status-option.selected {
            background: rgba(67, 97, 238, 0.15);
            border-color: #4361ee;
        }

        .status-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }

        .status-icon i {
            font-size: 20px;
            color: white;
        }

        .status-details {
            flex: 1;
        }

        .status-details h4 {
            color: white;
            margin: 0;
            font-size: 16px;
            font-weight: 500;
        }

        .status-details p {
            color: rgba(255, 255, 255, 0.7);
            margin: 5px 0 0;
            font-size: 13px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: 15px;
        }

        .status-indicator.online {
            background: #4ade80;
            box-shadow: 0 0 10px rgba(74, 222, 128, 0.5);
        }

        .status-indicator.maintenance {
            background: #fbbf24;
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }

        .status-indicator.offline {
            background: #f43f5e;
            box-shadow: 0 0 10px rgba(244, 63, 94, 0.5);
        }

        .status-message-section {
            margin-top: 30px;
        }

        .status-message-section label {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .status-message-section label i {
            color: #4361ee;
        }

        .input-group {
            position: relative;
            margin-bottom: 5px;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            padding-right: 40px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #4361ee;
            background: rgba(255, 255, 255, 0.08);
        }

        .input-group .input-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.5);
        }

        .status-message-section small {
            color: rgba(255, 255, 255, 0.5);
            font-size: 12px;
        }

        .status-modal-footer {
            padding: 20px 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }

        .btn-secondary, .btn-primary {
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .btn-primary {
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
            border: none;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }

        @media (max-width: 640px) {
            .status-modal-content {
                width: 95%;
                margin: 20px auto;
            }
            
            .status-modal-header {
                padding: 20px;
            }
            
            .status-modal-body {
                padding: 20px;
            }
            
            .status-modal-footer {
                padding: 20px;
                flex-direction: column;
            }
            
            .btn-secondary, .btn-primary {
                width: 100%;
                justify-content: center;
            }
        }

     
        .swal2-popup {
            background: rgba(31, 41, 55, 0.95) !important;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px !important;
            padding: 2rem !important;
            color: white !important;
        }

        .swal2-title {
            color: white !important;
            font-size: 1.5rem !important;
            font-weight: 600 !important;
            margin-bottom: 1rem !important;
        }

        .swal2-html-container {
            color: rgba(255, 255, 255, 0.9) !important;
            font-size: 1rem !important;
            margin: 1rem 0 !important;
        }

        .swal2-confirm {
            background: linear-gradient(135deg, #4361ee, #3a0ca3) !important;
            border: none !important;
            border-radius: 12px !important;
            padding: 0.75rem 1.5rem !important;
            font-weight: 500 !important;
            transition: all 0.3s ease !important;
        }

        .swal2-confirm:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3) !important;
        }

        .swal2-cancel {
            background: rgba(255, 255, 255, 0.1) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            color: white !important;
            border-radius: 12px !important;
            padding: 0.75rem 1.5rem !important;
            font-weight: 500 !important;
            transition: all 0.3s ease !important;
        }

        .swal2-cancel:hover {
            background: rgba(255, 255, 255, 0.15) !important;
        }

        .swal2-icon {
            border: none !important;
            margin: 1rem auto !important;
        }

        .swal2-success {
            background: rgba(74, 222, 128, 0.2) !important;
        }

        .swal2-error {
            background: rgba(244, 63, 94, 0.2) !important;
        }

        .swal2-warning {
            background: rgba(251, 191, 36, 0.2) !important;
        }

        .swal2-info {
            background: rgba(67, 97, 238, 0.2) !important;
        }

        
        .hamburger-menu {
            display: none;
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 1000;
            background: rgba(67, 97, 238, 0.9);
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .hamburger-menu .bar {
            width: 25px;
            height: 3px;
            background-color: white;
            margin: 5px 0;
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        .hamburger-menu.active .bar:nth-child(1) {
            transform: rotate(-45deg) translate(-5px, 6px);
        }

        .hamburger-menu.active .bar:nth-child(2) {
            opacity: 0;
        }

        .hamburger-menu.active .bar:nth-child(3) {
            transform: rotate(45deg) translate(-5px, -6px);
        }

        @media (max-width: 768px) {
            .hamburger-menu {
                display: block;
            }

            .sidebar {
                position: fixed;
                left: -100%;
                top: 0;
                width: 80%;
                height: 100vh;
                z-index: 999;
                transition: all 0.3s ease;
                box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
            }

            .sidebar.active {
                left: 0;
            }

            .admin-container {
                padding-top: 0;
            }

            .chat-container, .no-chat-selected {
                width: 100%;
                margin-left: 0;
            }

           
            .sidebar-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 998;
                backdrop-filter: blur(3px);
            }

            .sidebar-overlay.active {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .chat-container {
                display: flex;
                flex-direction: column;
                height: 100vh;
                background: #f8fafc;
            }

            .chat-header {
                padding: 12px 15px;
                background: #1a1a2e;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .chat-messages {
                flex: 1;
                padding: 15px;
                overflow-y: auto;
                background: #f8fafc;
            }

            .message {
                max-width: 85%;
                padding: 12px 15px;
                margin-bottom: 20px;
                position: relative;
            }

            .message.user-message {
                margin-right: auto;
                background: white;
                border-radius: 15px 15px 15px 5px;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            }

            .message.owner-message {
                margin-left: auto;
                background: linear-gradient(135deg, #4361ee, #3a0ca3);
                border-radius: 15px 15px 5px 15px;
                color: white;
            }

            .message .sender {
                font-size: 13px;
                margin-bottom: 5px;
                font-weight: 500;
            }

            .message .content {
                font-size: 14px;
                line-height: 1.5;
                margin-bottom: 15px;
                word-wrap: break-word;
            }

            .message .time {
                position: absolute;
                bottom: 8px;
                right: 12px;
                font-size: 11px;
                opacity: 0.8;
            }

            .chat-input {
                padding: 12px;
                background: white;
                border-top: 1px solid #e2e8f0;
                display: flex;
                align-items: center;
                gap: 10px;
                position: sticky;
                bottom: 0;
            }

            .chat-input input {
                flex: 1;
                padding: 12px 15px;
                border-radius: 20px;
                border: 1px solid #e2e8f0;
                background: #f8fafc;
                font-size: 14px;
            }

            .chat-input button {
                padding: 12px 20px;
                border-radius: 20px;
                background: linear-gradient(135deg, #4361ee, #3a0ca3);
                color: white;
                font-weight: 500;
                border: none;
            }

            .upload-image-btn {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: rgba(67, 97, 238, 0.1);
                color: #4361ee;
                display: flex;
                align-items: center;
                justify-content: center;
            }

           
            .user-info {
                display: flex;
                align-items: center;
                gap: 12px;
            }

            .user-avatar {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: linear-gradient(135deg, #4361ee, #3a0ca3);
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 16px;
            }

            .user-details h3 {
                color: white;
                font-size: 16px;
                margin: 0;
            }

            .user-details p {
                color: rgba(255, 255, 255, 0.7);
                font-size: 12px;
                margin: 2px 0 0 0;
            }

            .actions {
                display: flex;
                gap: 8px;
            }

            .actions button {
                padding: 8px 12px;
                border-radius: 8px;
                font-size: 12px;
                display: flex;
                align-items: center;
                gap: 5px;
            }

            #backBtn {
                background: rgba(255, 255, 255, 0.1);
                color: white;
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            #endChatBtn {
                background: rgba(239, 68, 68, 0.2);
                color: #fecaca;
                border: 1px solid rgba(239, 68, 68, 0.3);
            }

         
            .connection-status {
                position: fixed;
                bottom: 75px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(26, 26, 46, 0.9);
                padding: 8px 15px;
                border-radius: 20px;
                font-size: 12px;
                display: flex;
                align-items: center;
                gap: 8px;
                z-index: 1000;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
  
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <h2>Admin Login</h2>
            <div class="error-message" id="errorMessage">Username atau password salah!</div>
            <form class="login-form" id="loginForm">
                <input type="text" id="username" placeholder="Username" required>
                <input type="password" id="password" placeholder="Password" required>
                <button type="submit">Login</button>
            </form>
        </div>
    </div>

    <div class="admin-container">
        <div class="sidebar">
            <div class="logo">
                <img src="https://files.catbox.moe/qc4knm.jpg" alt="Vonix PS Logo">
                <h2>Vonix PS Admin</h2>
            </div>
            
            
            <div class="server-status-panel">
                <h3><i class="fas fa-server"></i> Status Server</h3>
                <div class="status-controls">
                    <button class="status-btn online-btn" onclick="setServerStatus('online', 'Server: Online')">
                        <div class="status-color online"></div>
                        <span>Online</span>
                    </button>
                    <button class="status-btn offline-btn" onclick="setServerStatus('offline', 'Server: Offline')">
                        <div class="status-color offline"></div>
                        <span>Offline</span>
                    </button>
                    <button class="status-btn maintenance-btn" onclick="setServerStatus('maintenance', 'Server: Maintenance')">
                        <div class="status-color maintenance"></div>
                        <span>Maintenance</span>
                    </button>
                </div>
            </div>
            
            <h3>Percakapan Aktif</h3>
            <ul class="user-list" id="userList">
             
                <div class="empty-state">Belum ada percakapan aktif</div>
            </ul>
        </div>
        
        <div id="noChatSelected" class="no-chat-selected">
            <i class="fas fa-comments"></i>
            <h3>Belum ada percakapan yang dipilih</h3>
            <p>Pilih percakapan dari daftar di sebelah kiri untuk mulai menjawab pertanyaan user.</p>
        </div>
        
        <div id="chatContainer" class="chat-container" style="display: none;">
            <div class="chat-header">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <div class="user-details">
                        <h3 id="userName">Nama User</h3>
                        <p id="userTime">Aktif 5 menit yang lalu</p>
                    </div>
                </div>
                
                <div class="actions">
                    <button id="backBtn"><i class="fas fa-arrow-left"></i> Kembali</button>
                    <button id="endChatBtn"><i class="fas fa-times"></i> Tutup Percakapan</button>
                    <button onclick="logout()" style="background-color: #ef4444; color: white;"><i class="fas fa-sign-out-alt"></i> Logout</button>
                </div>

               
                <div class="server-status-manager">
                    <button id="toggleServerStatus" class="server-status-btn online">
                        <span class="status-dot"></span>
                        <span class="status-text">Server: Online</span>
                    </button>
                </div>
            </div>
            
            <div class="chat-messages" id="chatMessages">
              
            </div>
            
            <div class="chat-input">
                <button id="uploadImageBtn" class="upload-image-btn"><i class="fas fa-image"></i></button>
                <input type="file" id="imageFileInput" accept="image/*" style="display: none;">
                <input type="text" id="replyInput" placeholder="Ketik balasan Anda...">
                <button id="sendReplyBtn">Kirim</button>
            </div>
        </div>
    </div>
    

    <div class="connection-status" id="connectionStatus">
        <div class="status-indicator" id="statusIndicator"></div>
        <span id="statusText">Menghubungkan...</span>
    </div>
    
 
    <div class="image-preview-modal" id="imagePreviewModal">
        <div class="close-preview" id="closeImagePreview">&times;</div>
        <img src="" alt="Preview" class="preview-image" id="previewImage">
    </div>
    
   
    <div class="status-modal" id="statusModal">
        <div class="status-modal-content">
            <div class="status-modal-header">
                <h3>Atur Status Server</h3>
                <span class="close-status-modal">&times;</span>
            </div>
            <div class="status-modal-body">
                <div class="status-option" data-status="online">
                    <div class="status-dot online"></div>
                    <div class="status-details">
                        <h4>Online</h4>
                        <p>Server berjalan normal</p>
                    </div>
                </div>
                <div class="status-option" data-status="maintenance">
                    <div class="status-dot maintenance"></div>
                    <div class="status-details">
                        <h4>Maintenance</h4>
                        <p>Server sedang dalam pemeliharaan</p>
                    </div>
                </div>
                <div class="status-option" data-status="offline">
                    <div class="status-dot offline"></div>
                    <div class="status-details">
                        <h4>Offline</h4>
                        <p>Server tidak tersedia</p>
                    </div>
                </div>
                <div class="status-message">
                    <label for="customStatusMessage">Pesan Status Kustom:</label>
                    <input type="text" id="customStatusMessage" placeholder="Server: Online" value="Server: Online">
                </div>
            </div>
            <div class="status-modal-footer">
                <button id="cancelStatusChange">Batal</button>
                <button id="saveStatusChange">Simpan Perubahan</button>
            </div>
        </div>
    </div>
    
    <div class="hamburger-menu" id="hamburgerMenu">
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
    </div>

    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <script>
     
        const firebaseConfig = {
            apiKey: "AIzaSyBQJSlxeUcyKbBh_a9hJdmyVYDrDxT_F5Q",
            authDomain: "vonix-ps-chat.firebaseapp.com",
            databaseURL: "https://vonix-ps-chat-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "vonix-ps-chat",
            storageBucket: "vonix-ps-chat.appspot.com",
            messagingSenderId: "297809543925",
            appId: "1:297809543925:web:dc13bfe5c60abbb56c5bf2"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        } else {
            firebase.app();
        }
        const database = firebase.database();
        const storage = firebase.storage();
  
        const userList = document.getElementById('userList');
        const noChatSelected = document.getElementById('noChatSelected');
        const chatContainer = document.getElementById('chatContainer');
        const chatMessages = document.getElementById('chatMessages');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const userTime = document.getElementById('userTime');
        const replyInput = document.getElementById('replyInput');
        const sendReplyBtn = document.getElementById('sendReplyBtn');
        const endChatBtn = document.getElementById('endChatBtn');
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        
        let currentChatId = null;
        const activeChats = {};
        const unreadMessages = {};
        
        const displayedMessageIds = new Set();
        
   
        const connectedRef = database.ref(".info/connected");
        connectedRef.on("value", (snap) => {
            if (snap.val() === true) {
                console.log("Connected to Firebase");
                statusIndicator.style.backgroundColor = "#4CAF50";
                statusText.textContent = "Terhubung";
                
               
                loadChats();
            } else {
                console.log("Disconnected from Firebase");
                statusIndicator.style.backgroundColor = "#F44336";
                statusText.textContent = "Terputus";
            }
        });
        
       
        function loadChats() {
            
            database.ref('chats').on('child_added', (snapshot) => {
                const chatId = snapshot.key;
                const chatData = snapshot.val();
                
                console.log("Percakapan baru terdeteksi:", chatId, chatData);
                
          
                activeChats[chatId] = chatData;
                
               
                unreadMessages[chatId] = 0;
                
               
                updateUserList();
             
                listenForNewMessages(chatId);
            }, (error) => {
                console.error("Error saat mendengarkan percakapan baru:", error);
                statusText.textContent = "Error: " + error.message;
            });
            
            
            database.ref('chats').on('child_changed', (snapshot) => {
                const chatId = snapshot.key;
                const chatData = snapshot.val();
                
                console.log("Percakapan berubah:", chatId, chatData);
                
              
                activeChats[chatId] = chatData;
                
               
                if (currentChatId === chatId) {
                    userName.textContent = chatData.name || "User tanpa nama";
                    userAvatar.textContent = (chatData.name || "User")[0].toUpperCase();
                }
                
             
                updateUserList();
            });
            
         
            database.ref('chats').on('child_removed', (snapshot) => {
                const chatId = snapshot.key;
              
                delete activeChats[chatId];
                delete unreadMessages[chatId];
                
      
                updateUserList();
                
      
                if (currentChatId === chatId) {
                    currentChatId = null;
                    chatContainer.style.display = 'none';
                    noChatSelected.style.display = 'flex';
                }
            });
        }

    
        function listenForNewMessages(chatId) {
            console.log("Mulai mendengarkan pesan dari percakapan:", chatId);
            
            database.ref(`chats/${chatId}/messages`).orderByChild('timestamp').on('child_added', (snapshot) => {
                const messageId = snapshot.key;
                const messageData = snapshot.val();
                
                console.log("Pesan terdeteksi di percakapan", chatId, ":", messageData);
           
                if (messageData.sender === 'user' && messageData.status === 'waiting') {
                
                    if (currentChatId === chatId) {
                        markMessageAsRead(chatId, messageId);
                    } else {
                 
                        unreadMessages[chatId]++;
                        updateUserList();
                        
                   
                        playNotificationSound();
                    }
                }
                
              
                if (currentChatId === chatId) {
                    displayMessage(messageData, messageId);
                }
            }, (error) => {
                console.error("Error saat mendengarkan pesan baru di percakapan", chatId, ":", error);
            });
        }
        
   
        function playNotificationSound() {
            const audio = new Audio('https://cdn.pixabay.com/download/audio/2021/08/04/audio_0625c1cec9.mp3?filename=notification-sound-7062.mp3');
            audio.volume = 0.5;
            audio.play().catch(e => console.log('Audio play failed:', e));
        }
        
    
        function updateUserList() {
            
            if (Object.keys(activeChats).length > 0) {
                userList.innerHTML = '';
            } else {
                userList.innerHTML = '<div class="empty-state">Belum ada percakapan aktif</div>';
                return;
            }
            
          
            const sortedChats = Object.entries(activeChats)
                .sort(([, a], [, b]) => b.last_activity - a.last_activity);
            
         
            for (const [chatId, chatData] of sortedChats) {
                const listItem = document.createElement('li');
                listItem.className = 'user-item';
                if (chatId === currentChatId) {
                    listItem.classList.add('active');
                }
                
               
                const userName = chatData.name || "User tanpa nama";
                
             
                const lastActivity = new Date(chatData.last_activity);
                const now = new Date();
                const diffMs = now - lastActivity;
                const diffMins = Math.round(diffMs / 60000);
                
                let statusClass = 'status-offline';
                if (diffMins < 5) {
                    statusClass = 'status-online';
                } else if (diffMins < 30) {
                    statusClass = 'status-away';
                }
                
                let timeString;
                if (diffMins < 1) {
                    timeString = 'Baru saja';
                } else if (diffMins < 60) {
                    timeString = `${diffMins} menit yang lalu`;
                } else {
                    const diffHours = Math.floor(diffMins / 60);
                    if (diffHours < 24) {
                        timeString = `${diffHours} jam yang lalu`;
                    } else {
                        const diffDays = Math.floor(diffHours / 24);
                        timeString = `${diffDays} hari yang lalu`;
                    }
                }
                
                let lastMessagePreview = 'Belum ada pesan';
                if (chatData.messages) {
                    const messages = Object.values(chatData.messages);
                    if (messages.length > 0) {
                        const sortedMessages = messages.sort((a, b) => b.timestamp - a.timestamp);
                        const lastMessage = sortedMessages[0];
                        if (lastMessage.messageType === 'image') {
                            lastMessagePreview = '📷 Gambar';
                        } else {
                            lastMessagePreview = lastMessage.message.substring(0, 30) + (lastMessage.message.length > 30 ? '...' : '');
                        }
                    }
                }
                
                listItem.innerHTML = `
                    <div class="name">
                        <div>
                            <span class="user-status ${statusClass}"></span>
                            ${userName}
                        </div>
                        ${unreadMessages[chatId] > 0 ? `<div class="notification">${unreadMessages[chatId]}</div>` : ''}
                    </div>
                    <div class="preview">${lastMessagePreview}</div>
                    <div class="time">
                        <i class="fas fa-clock"></i> ${timeString}
                    </div>
                `;
                
            
                listItem.addEventListener('click', () => {
                    selectChat(chatId);
                });
                
                userList.appendChild(listItem);
            }
        }
        
       
        function selectChat(chatId) {
            currentChatId = chatId;
            
           
            noChatSelected.style.display = 'none';
            chatContainer.style.display = 'flex';
            
          
            const chat = activeChats[chatId];
            userName.textContent = chat.name || "User tanpa nama";
            userAvatar.textContent = (chat.name || "User")[0].toUpperCase();
           
            const lastActivity = new Date(chat.last_activity);
            const now = new Date();
            const diffMs = now - lastActivity;
            const diffMins = Math.round(diffMs / 60000);
            
            let timeString;
            if (diffMins < 1) {
                timeString = 'Aktif baru saja';
            } else if (diffMins < 60) {
                timeString = `Aktif ${diffMins} menit yang lalu`;
            } else {
                const diffHours = Math.floor(diffMins / 60);
                if (diffHours < 24) {
                    timeString = `Aktif ${diffHours} jam yang lalu`;
                } else {
                    const diffDays = Math.floor(diffHours / 24);
                    timeString = `Aktif ${diffDays} hari yang lalu`;
                }
            }
            
            userTime.textContent = timeString;
            
       
            chatMessages.innerHTML = '';
            
        
            loadMessages(chatId);
            
      
            unreadMessages[chatId] = 0;
            
            updateUserList();
        }
        
        function loadMessages(chatId) {
            displayedMessageIds.clear();
            
            database.ref(`chats/${chatId}/messages`).orderByChild('timestamp').once('value', (snapshot) => {
                const messages = snapshot.val();
                
                chatMessages.innerHTML = '';
                
                if (!messages) {
                    const emptyMessage = document.createElement('div');
                    emptyMessage.className = 'empty-message';
                    emptyMessage.textContent = 'Belum ada pesan';
                    chatMessages.appendChild(emptyMessage);
                    return;
                }
                
         
                const messagesByDate = {};
              
                const sortedMessages = Object.entries(messages)
                    .sort(([, a], [, b]) => a.timestamp - b.timestamp);
                
        
                sortedMessages.forEach(([messageId, messageData]) => {
                    const messageDate = new Date(messageData.timestamp).toLocaleDateString();
                    if (!messagesByDate[messageDate]) {
                        messagesByDate[messageDate] = [];
                    }
                    messagesByDate[messageDate].push([messageId, messageData]);
                });
                
         
                Object.keys(messagesByDate).forEach(date => {
                    messagesByDate[date].forEach(([messageId, messageData]) => {
                        displayMessage(messageData, messageId, false);
                        
                        if (messageData.sender === 'user' && messageData.status === 'waiting') {
                            markMessageAsRead(chatId, messageId);
                        }
                    });
                });
                
                chatMessages.scrollTop = chatMessages.scrollHeight;
            });
        }
        
   
        function displayMessage(messageData, messageId, skipDateCheck = true) {
            if (displayedMessageIds.has(messageId)) {
                console.log("Pesan sudah ditampilkan, skip:", messageId);
                return;
            }
            
            const existingMessages = chatMessages.querySelectorAll('.message');
            let isDuplicate = false;
            
            for (const msg of existingMessages) {
                const msgContent = msg.querySelector('.content')?.textContent;
                const msgTime = msg.dataset.timestamp;
                
                if (msgContent === messageData.message && 
                    msgTime && messageData.timestamp && 
                    Math.abs(parseInt(msgTime) - messageData.timestamp) < 5000) {
                    console.log("Pesan duplikat terdeteksi:", messageData.message);
                    isDuplicate = true;
                    break;
                }
            }
            
            if (isDuplicate) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = messageData.sender === 'user' ? 'message user-message' : 'message owner-message';
            messageDiv.dataset.timestamp = messageData.timestamp;
            messageDiv.dataset.id = messageId;
            
            const formattedTime = formatTimestamp(messageData.timestamp);
            
            messageDiv.innerHTML = `
                <div class="sender">${messageData.sender === 'user' ? (messageData.name || 'User') : 'Owner Vonix PS'}</div>
                <div class="content">${messageData.message}</div>
                <div class="time">${formattedTime}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            displayedMessageIds.add(messageId);
        }
        
  
        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${hours}:${minutes}`;
        }
        
 
        function markMessageAsRead(chatId, messageId) {
            console.log("Menandai pesan sebagai dibaca:", chatId, messageId);
            
            database.ref(`chats/${chatId}/messages/${messageId}`).update({
                status: 'read'
            }).then(() => {
                console.log("Status pesan berhasil diupdate menjadi 'read'");
            }).catch(error => {
                console.error("Error saat mengupdate status pesan:", error);
            });
        }
        
   
        sendReplyBtn.addEventListener('click', sendReply);
        replyInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendReply();
            }
        });
        
        function sendReply() {
            const message = replyInput.value.trim();
            if (message === '' || !currentChatId) return;
          
            sendReplyBtn.disabled = true;
            sendReplyBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            
            const now = new Date();
            const timestamp = now.getTime();
            
            console.log("Mengirim balasan:", message, "ke chatId:", currentChatId);
            
            const tempMessageDiv = document.createElement('div');
            tempMessageDiv.className = 'message owner-message';
            tempMessageDiv.innerHTML = `
                <div class="sender">Owner Vonix PS</div>
                <div class="content">${message}</div>
                <div class="time">${formatTimestamp(timestamp)}</div>
                <div class="status-sending">Mengirim...</div>
            `;
            chatMessages.appendChild(tempMessageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
          
            sendMessageWithRetry(currentChatId, message, timestamp, tempMessageDiv, 0);
            
            replyInput.value = '';
        }
        
  
        function sendMessageWithRetry(chatId, message, timestamp, messageDiv, retryCount) {
            const maxRetries = 3;

            const messageHash = hashString(message + timestamp);
            const consistentMsgId = `owner_${timestamp}_${messageHash}`;
            
           
            database.ref(`chats/${chatId}/messages/${consistentMsgId}`).set({
                sender: 'owner',
                message: message,
                timestamp: timestamp
            }).then(() => {
                console.log("Balasan berhasil disimpan di Firebase");
                
               
                if (messageDiv) {
                    const statusEl = messageDiv.querySelector('.status-sending');
                    if (statusEl) {
                        statusEl.textContent = 'Terkirim';
                        statusEl.className = 'status-sent';
                        
                    
                        setTimeout(() => {
                            statusEl.remove();
                        }, 2000);
                    }
                }
                
               
                return database.ref(`chats/${chatId}`).update({
                    last_activity: timestamp
                });
            }).then(() => {
                console.log("Waktu aktivitas berhasil diupdate");
               
                sendReplyBtn.disabled = false;
                sendReplyBtn.innerHTML = 'Kirim';
            }).catch(error => {
                console.error("Error saat mengirim balasan:", error);
                
              
                if (retryCount < maxRetries) {
                    console.log(`Mencoba kembali (${retryCount + 1}/${maxRetries})...`);
                    
                   
                    if (messageDiv) {
                        const statusEl = messageDiv.querySelector('.status-sending');
                        if (statusEl) {
                            statusEl.textContent = `Mencoba kembali (${retryCount + 1}/${maxRetries})...`;
                        }
                    }
                 
                    setTimeout(() => {
                        sendMessageWithRetry(chatId, message, timestamp, messageDiv, retryCount + 1);
                    }, 1000);
                } else {
                    
                    alert("Gagal mengirim balasan setelah beberapa percobaan. Silakan coba lagi.");
                    
                   
                    if (messageDiv) {
                        const statusEl = messageDiv.querySelector('.status-sending');
                        if (statusEl) {
                            statusEl.textContent = 'Gagal terkirim';
                            statusEl.className = 'status-failed';
                        }
                    }
                    
                    sendReplyBtn.disabled = false;
                    sendReplyBtn.innerHTML = 'Kirim';
                }
            });
        }
        
        
        function hashString(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; 
            }
            return Math.abs(hash).toString(16).substring(0, 8);
        }
        
       
        endChatBtn.addEventListener('click', () => {
            if (!currentChatId) return;
            
            if (confirm('Apakah Anda yakin ingin menutup percakapan ini? Percakapan akan diarsipkan tetapi tidak dihapus.')) {
               
                const now = new Date();
                const timestamp = now.getTime();
                
                backupChat(currentChatId);
                
                const newMessageRef = database.ref(`chats/${currentChatId}/messages`).push();
                newMessageRef.set({
                    sender: 'owner',
                    message: 'Percakapan ini telah ditutup oleh Owner. Terima kasih telah menghubungi kami.',
                    timestamp: timestamp,
                    isSystemMessage: true
                });
                
             
                database.ref(`chats/${currentChatId}`).update({
                    status: 'archived',
                    archived_at: timestamp,
                    last_activity: timestamp
                });
                
                currentChatId = null;
                chatContainer.style.display = 'none';
                noChatSelected.style.display = 'flex';
                
          
                updateUserList();
            }
        });

     
        document.getElementById('backBtn').addEventListener('click', () => {
            currentChatId = null;
            chatContainer.style.display = 'none';
            noChatSelected.style.display = 'flex';
            updateUserList();
        });

        
        document.addEventListener('DOMContentLoaded', function() {
          
            console.log("Menguji koneksi ke Firebase...");
            
            const testRef = database.ref('test_connection_admin');
            testRef.set({
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                message: "Tes koneksi dari admin panel"
            }).then(() => {
                console.log("Data tes berhasil dikirim");
                return testRef.once('value');
            }).then((snapshot) => {
                console.log("Berhasil membaca data:", snapshot.val());
                statusIndicator.style.backgroundColor = "#4CAF50";
                statusText.textContent = "Terhubung - Tes Berhasil";
                
             
                const lastActiveChat = localStorage.getItem('activeChat');
                if (lastActiveChat) {
                    console.log("Memulihkan chat aktif:", lastActiveChat);
                    
                }
            }).catch(error => {
                console.error("Error tes koneksi:", error);
                statusIndicator.style.backgroundColor = "#F44336";
                statusText.textContent = "Error: " + error.message;
            });
        });

  
        const uploadImageBtn = document.getElementById('uploadImageBtn');
        const imageFileInput = document.getElementById('imageFileInput');
        const imagePreviewModal = document.getElementById('imagePreviewModal');
        const previewImage = document.getElementById('previewImage');
        const closeImagePreview = document.getElementById('closeImagePreview');
        

        uploadImageBtn.addEventListener('click', function() {
            imageFileInput.click();
        });
        
       
        imageFileInput.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
          
                if (!file.type.match('image.*')) {
                    alert('Hanya file gambar yang diperbolehkan');
                    return;
                }
                
              
                if (file.size > 5 * 1024 * 1024) {
                    alert('Ukuran file maksimal 5MB');
                    return;
                }
                
                uploadImageToChat(file);
            }
        });
        
   
        function uploadImageToChat(file) {
            if (!currentChatId) {
                alert('Pilih chat terlebih dahulu');
                return;
            }
            
            const now = new Date();
            const timestamp = now.getTime();
            const fileName = `admin_${currentChatId}_${timestamp}_${file.name.replace(/[^a-zA-Z0-9.]/g, '_')}`;
            
           
            const loadingMessage = document.createElement('div');
            loadingMessage.className = 'message owner-message';
            
            const loadingContainer = document.createElement('div');
            loadingContainer.className = 'image-loading';
            loadingContainer.innerHTML = '<i class="fas fa-spinner"></i> Mengunggah gambar...';
            loadingMessage.appendChild(loadingContainer);
            
            const progressContainer = document.createElement('div');
            progressContainer.className = 'upload-progress';
            const progressBar = document.createElement('div');
            progressBar.className = 'progress-bar';
            progressContainer.appendChild(progressBar);
            loadingMessage.appendChild(progressContainer);
            
            chatMessages.appendChild(loadingMessage);
            chatMessages.scrollTop = chatMessages.scrollHeight;
           
            const storageRef = storage.ref(`chat_images/${fileName}`);
            
           
            const metadata = {
                contentType: file.type,
                customMetadata: {
                    'uploadedBy': 'admin',
                    'timestamp': timestamp.toString(),
                    'chatId': currentChatId,
                    'Access-Control-Allow-Origin': '*',
                    'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE',
                    'Access-Control-Allow-Headers': 'Content-Type'
                }
            };
            
         
            const uploadTask = storageRef.put(file, metadata);
            
            
            uploadTask.on('state_changed', 
                
                (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    progressBar.style.width = progress + '%';
                },
               
                (error) => {
                    console.error('Error upload:', error);
                    loadingContainer.innerHTML = '<i class="fas fa-exclamation-circle"></i> Gagal mengunggah gambar';
                    loadingContainer.style.color = '#ff5757';
                    
                    
                    const errorDetails = document.createElement('div');
                    errorDetails.textContent = `Error: ${error.code} - ${error.message}`;
                    errorDetails.style.fontSize = '12px';
                    errorDetails.style.marginTop = '5px';
                    loadingContainer.appendChild(errorDetails);
                },
              
                async () => {
                    try {
                        
                        const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();
                        
                      
                        let secureURL = downloadURL;
                        if (!secureURL.startsWith('https')) {
                            secureURL = secureURL.replace('http:', 'https:');
                        }
                        const urlWithCacheBuster = `${secureURL}?timestamp=${timestamp}&rand=${Math.random().toString(36).substring(7)}`;
                        
                    
                        chatMessages.removeChild(loadingMessage);
                        
                     
                        const messageHash = hashString(downloadURL + timestamp);
                        const consistentMsgId = `owner_image_${timestamp}_${messageHash}`;
                        
                        const imageContainer = document.createElement('div');
                        imageContainer.className = 'image-container';
                        
                        const image = document.createElement('img');
                        image.className = 'message-image';
                        image.src = urlWithCacheBuster;
                        image.addEventListener('click', function() {
                            showImagePreview(urlWithCacheBuster);
                        });
                        
                        imageContainer.appendChild(image);
                        
                        const messageDiv = document.createElement('div');
                        messageDiv.className = 'message owner-message';
                        messageDiv.dataset.timestamp = timestamp;
                        messageDiv.dataset.id = consistentMsgId;
                        
                        const senderDiv = document.createElement('div');
                        senderDiv.className = 'sender';
                        senderDiv.textContent = 'Owner Vonix PS';
                        
                        const timeDiv = document.createElement('div');
                        timeDiv.className = 'time';
                        timeDiv.textContent = formatTimestamp(timestamp);
                        
                        messageDiv.appendChild(senderDiv);
                        messageDiv.appendChild(imageContainer);
                        messageDiv.appendChild(timeDiv);
                        
                        chatMessages.appendChild(messageDiv);
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                        
                   
                        return database.ref(`chats/${currentChatId}/messages/${consistentMsgId}`).set({
                            sender: 'owner',
                            messageType: 'image',
                            imageURL: downloadURL,
                            message: 'Image',
                            timestamp: timestamp
                        }).then(() => {
                            console.log("Gambar berhasil disimpan di Firebase");

                            return database.ref(`chats/${currentChatId}`).update({
                                last_activity: timestamp
                            });
                        }).then(() => {
                            console.log("Waktu aktivitas berhasil diupdate");
                        }).catch(error => {
                            console.error("Error saat menyimpan pesan gambar:", error);
                            alert("Gambar berhasil diupload tetapi gagal menyimpan ke database. Silakan coba lagi.");
                        });
                    } catch (error) {
                        console.error('Error mendapatkan URL download:', error);
                        loadingContainer.innerHTML = '<i class="fas fa-exclamation-circle"></i> Gagal mendapatkan URL gambar';
                        loadingContainer.style.color = '#ff5757';
                        
                        
                        const errorDetails = document.createElement('div');
                        errorDetails.textContent = `Error: ${error.code || ''} - ${error.message}`;
                        errorDetails.style.fontSize = '12px';
                        errorDetails.style.marginTop = '5px';
                        loadingContainer.appendChild(errorDetails);
                    }
                }
            );
        }
        
     
        function showImagePreview(imageURL) {
            previewImage.src = imageURL;
            imagePreviewModal.classList.add('active');
        }
        

        closeImagePreview.addEventListener('click', function() {
            imagePreviewModal.classList.remove('active');
        });
        

        imagePreviewModal.addEventListener('click', function(e) {
            if (e.target === imagePreviewModal) {
                imagePreviewModal.classList.remove('active');
            }
        });

      
        window.addEventListener('beforeunload', function(e) {
          
            if (currentChatId) {
                localStorage.setItem('activeChat', currentChatId);
            }
        });
        
       
        function backupChat(chatId) {
            if (!chatId) return;
            
        
            database.ref(`chats/${chatId}`).once('value', (snapshot) => {
                const chatData = snapshot.val();
                if (chatData) {
                    const backupPath = `chat_backups/${chatId}_${Date.now()}`;
                    database.ref(backupPath).set(chatData)
                        .then(() => console.log(`Chat ${chatId} berhasil dicadangkan ke ${backupPath}`))
                        .catch(error => console.error(`Gagal mencadangkan chat: ${error.message}`));
                }
            });
        }

 
        document.addEventListener('DOMContentLoaded', function() {
            const loginContainer = document.getElementById('loginContainer');
            const loginForm = document.getElementById('loginForm');
            const errorMessage = document.getElementById('errorMessage');
            const adminContent = document.querySelector('.admin-container');

            // Cek status login saat halaman dimuat
            if (!localStorage.getItem('adminLoggedIn')) {
                console.log('User belum login, menampilkan form login');
                loginContainer.style.display = 'flex';
                adminContent.style.display = 'none';
            } else {
                console.log('User sudah login, menampilkan admin panel');
                loginContainer.style.display = 'none';
                adminContent.style.display = 'flex';
            }

            // Handle form login
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                console.log('Mencoba login dengan username:', username);

                if (username === 'kuzuroken' && password === '@kuzuroken#4') {
                    console.log('Login berhasil');
                    localStorage.setItem('adminLoggedIn', 'true');
                    loginContainer.style.display = 'none';
                    adminContent.style.display = 'flex';
                    errorMessage.style.display = 'none';
                } else {
                    console.log('Login gagal');
                    errorMessage.style.display = 'block';
                    localStorage.removeItem('adminLoggedIn');
                }
            });
        });

     
        function logout() {
            console.log('User logout');
            localStorage.removeItem('adminLoggedIn');
            window.location.reload();
        }

     
        document.addEventListener('DOMContentLoaded', function() {
            const toggleServerStatusBtn = document.getElementById('toggleServerStatus');
            const statusModal = document.getElementById('statusModal');
            const closeStatusModal = document.querySelector('.close-status-modal');
            const statusOptions = document.querySelectorAll('.status-option');
            const cancelStatusChange = document.getElementById('cancelStatusChange');
            const saveStatusChange = document.getElementById('saveStatusChange');
            const customStatusMessage = document.getElementById('customStatusMessage');
            
            let currentStatus = 'online';
            let currentMessage = 'Server: Online';
            
         
            database.ref('serverStatus').once('value', (snapshot) => {
                const serverStatus = snapshot.val() || { status: 'online', message: 'Server: Online' };
                currentStatus = serverStatus.status;
                currentMessage = serverStatus.message;
                
               
                updateStatusButton(currentStatus, currentMessage);
            
                statusOptions.forEach(option => {
                    if(option.getAttribute('data-status') === currentStatus) {
                        option.classList.add('selected');
                    }
                });
             
                customStatusMessage.value = currentMessage;
            });
            
          
            toggleServerStatusBtn.addEventListener('click', function() {
                statusModal.style.display = 'block';
                setTimeout(() => {
                    statusModal.classList.add('show');
                }, 10);
            });
            
           
            function closeModal() {
                statusModal.classList.remove('show');
                setTimeout(() => {
                    statusModal.style.display = 'none';
                }, 300);
            }
            
            closeStatusModal.addEventListener('click', closeModal);
            cancelStatusChange.addEventListener('click', closeModal);
          
            window.addEventListener('click', function(event) {
                if (event.target === statusModal) {
                    closeModal();
                }
            });
            
       
            statusOptions.forEach(option => {
                option.addEventListener('click', function() {
                  
                    statusOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    this.classList.add('selected');
                 
                    currentStatus = this.getAttribute('data-status');
               
                    if (currentStatus === 'online') {
                        customStatusMessage.value = 'Server: Online';
                    } else if (currentStatus === 'maintenance') {
                        customStatusMessage.value = 'Server: Maintenance';
                    } else if (currentStatus === 'offline') {
                        customStatusMessage.value = 'Server: Offline';
                    }
                    
                    currentMessage = customStatusMessage.value;
                });
            });
            
          
            saveStatusChange.addEventListener('click', function() {
               
                currentMessage = customStatusMessage.value.trim() || 'Server: ' + currentStatus.charAt(0).toUpperCase() + currentStatus.slice(1);
               
                database.ref('serverStatus').set({
                    status: currentStatus,
                    message: currentMessage,
                    updatedAt: firebase.database.ServerValue.TIMESTAMP
                }).then(() => {
                    console.log('Status server berhasil diperbarui');
                    
              
                    updateStatusButton(currentStatus, currentMessage);
                 
                    closeModal();
                }).catch(error => {
                    console.error('Error saat memperbarui status server:', error);
                    alert('Gagal memperbarui status server. Silakan coba lagi.');
                });
            });
            
           
            function updateStatusButton(status, message) {
              
                toggleServerStatusBtn.classList.remove('online', 'maintenance', 'offline');
                
                toggleServerStatusBtn.classList.add(status);
              
                toggleServerStatusBtn.querySelector('.status-text').textContent = message;
            }
        });

       
        function setServerStatus(status, message) {
           
            const serverStatusRef = firebase.database().ref('serverStatus');
      
            serverStatusRef.set({
                status: status,
                message: message
            }).then(() => {
                alert(`Status server berhasil diubah menjadi ${message}`);
            }).catch((error) => {
                alert(`Error: ${error.message}`);
            });
        }
        
    
        function applyCustomStatus() {
            const customMessage = document.getElementById('customStatusMessage').value.trim();
            if (!customMessage) {
                alert('Mohon masukkan pesan status kustom');
                return;
            }
     
            const activeStatus = document.querySelector('.status-btn.active');
            let status = 'online'; 
            
          
            if (activeStatus) {
                if (activeStatus.classList.contains('online-btn')) {
                    status = 'online';
                } else if (activeStatus.classList.contains('offline-btn')) {
                    status = 'offline';
                } else if (activeStatus.classList.contains('maintenance-btn')) {
                    status = 'maintenance';
                }
            }
            
       
            setServerStatus(status, customMessage);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const statusBtns = document.querySelectorAll('.status-btn');
            
            statusBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                
                    statusBtns.forEach(b => b.classList.remove('active'));
                  
                    this.classList.add('active');
                });
            });
            
          
            firebase.database().ref('serverStatus').once('value', (snapshot) => {
                const serverStatus = snapshot.val() || { status: 'online', message: 'Server: Online' };
                
              
                if (serverStatus.status === 'online') {
                    document.querySelector('.online-btn').classList.add('active');
                } else if (serverStatus.status === 'offline') {
                    document.querySelector('.offline-btn').classList.add('active');
                } else if (serverStatus.status === 'maintenance') {
                    document.querySelector('.maintenance-btn').classList.add('active');
                }
                
              
                if (serverStatus.message !== 'Server: Online' && 
                    serverStatus.message !== 'Server: Offline' && 
                    serverStatus.message !== 'Server: Maintenance') {
                    document.getElementById('customStatusMessage').value = serverStatus.message;
                }
            });
        });

        const statusModal = document.getElementById('statusModal');
        const closeStatusModal = document.querySelector('.close-status-modal');
        const statusOptions = document.querySelectorAll('.status-option');
        const customMessageInput = document.getElementById('customStatusMessage');
        const saveStatusBtn = document.getElementById('saveStatusChange');
        const cancelStatusBtn = document.getElementById('cancelStatusChange');

        let currentStatus = 'online';

        function showStatusModal() {
            statusModal.style.display = 'flex';
            setTimeout(() => {
                statusModal.classList.add('show');
            }, 10);
        }

      
        function hideStatusModal() {
            statusModal.classList.remove('show');
            setTimeout(() => {
                statusModal.style.display = 'none';
            }, 300);
        }

        statusOptions.forEach(option => {
            option.addEventListener('click', () => {
                statusOptions.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                currentStatus = option.dataset.status;
            });
        });

       
        closeStatusModal.addEventListener('click', hideStatusModal);
        cancelStatusBtn.addEventListener('click', hideStatusModal);

       
        saveStatusBtn.addEventListener('click', () => {
            const customMessage = customMessageInput.value.trim();
            const statusText = document.getElementById('statusText');
            const statusIndicator = document.querySelector('.server-status .status-indicator');
            
           
            statusIndicator.className = 'status-indicator ' + currentStatus;
            
            
            let statusMessage = '';
            switch(currentStatus) {
                case 'online':
                    statusMessage = 'Server Online';
                    break;
                case 'maintenance':
                    statusMessage = 'Server Maintenance';
                    break;
                case 'offline':
                    statusMessage = 'Server Offline';
                    break;
            }
            
            if (customMessage) {
                statusMessage += ': ' + customMessage;
            }
            
            statusText.textContent = statusMessage;
            
          
            hideStatusModal();
            
        
            showNotification('Status server berhasil diperbarui', 'success');
        });

     
        window.addEventListener('click', (e) => {
            if (e.target === statusModal) {
                hideStatusModal();
            }
        });

     
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icon = document.createElement('i');
            icon.className = type === 'success' ? 'fas fa-check-circle' : 'fas fa-info-circle';
            
            const text = document.createElement('span');
            text.textContent = message;
            
            notification.appendChild(icon);
            notification.appendChild(text);
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }

      
        const style = document.createElement('style');
        style.textContent = `
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #1a1a2e;
            border-radius: 12px;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 2100;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid #4ade80;
        }

        .notification.info {
            border-left: 4px solid #4361ee;
        }

        .notification i {
            font-size: 20px;
        }

        .notification.success i {
            color: #4ade80;
        }

        .notification.info i {
            color: #4361ee;
        }
        `;
        document.head.appendChild(style);

     
        function setServerStatus(status, message) {
            let icon, title, confirmButtonText;
            
            switch(status) {
                case 'online':
                    icon = 'success';
                    title = 'Atur Status Server';
                    confirmButtonText = 'Aktifkan Server';
                    break;
                case 'maintenance':
                    icon = 'warning';
                    title = 'Mode Maintenance';
                    confirmButtonText = 'Aktifkan Maintenance';
                    break;
                case 'offline':
                    icon = 'error';
                    title = 'Nonaktifkan Server';
                    confirmButtonText = 'Nonaktifkan';
                    break;
            }

            Swal.fire({
                icon: icon,
                title: title,
                html: `
                    <div style="text-align: left; margin-bottom: 1rem;">
                        <p style="margin-bottom: 1rem;">Apakah Anda yakin ingin mengubah status server menjadi:</p>
                        <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 12px; margin-bottom: 1rem;">
                            <strong style="color: #4ade80">${message}</strong>
                        </div>
                        <input type="text" id="customMessage" class="swal2-input" placeholder="Pesan tambahan (opsional)" 
                            style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; margin-top: 1rem;">
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: confirmButtonText,
                cancelButtonText: 'Batal',
                backdrop: 'rgba(0,0,0,0.7)',
                customClass: {
                    container: 'modern-swal'
                },
                preConfirm: () => {
                    const customMsg = document.getElementById('customMessage').value;
                    return customMsg ? `${message} - ${customMsg}` : message;
                }
            }).then((result) => {
                if (result.isConfirmed) {
                   
                    const serverStatusRef = firebase.database().ref('serverStatus');
                    serverStatusRef.set({
                        status: status,
                        message: result.value,
                        updatedAt: firebase.database.ServerValue.TIMESTAMP
                    }).then(() => {
                        Swal.fire({
                            icon: 'success',
                            title: 'Status Diperbarui!',
                            text: 'Status server berhasil diubah',
                            timer: 2000,
                            showConfirmButton: false
                        });
                    }).catch((error) => {
                        Swal.fire({
                            icon: 'error',
                            title: 'Gagal!',
                            text: `Error: ${error.message}`,
                        });
                    });
                }
            });
        }

     
        document.addEventListener('DOMContentLoaded', function() {
            const hamburgerMenu = document.getElementById('hamburgerMenu');
            const sidebar = document.querySelector('.sidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');

            function toggleSidebar() {
                hamburgerMenu.classList.toggle('active');
                sidebar.classList.toggle('active');
                sidebarOverlay.classList.toggle('active');
                document.body.style.overflow = sidebar.classList.contains('active') ? 'hidden' : '';
            }

            hamburgerMenu.addEventListener('click', toggleSidebar);
            sidebarOverlay.addEventListener('click', toggleSidebar);

            
            const userItems = document.querySelectorAll('.user-item');
            userItems.forEach(item => {
                item.addEventListener('click', () => {
                    if (window.innerWidth <= 768) {
                        toggleSidebar();
                    }
                });
            });

           
            window.addEventListener('resize', () => {
                if (window.innerWidth > 768 && sidebar.classList.contains('active')) {
                    toggleSidebar();
                }
            });
        });

    </script>
</body>
</html> 